<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GhostPlayer - GitHub 视频播放器</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-color: #1a1a1a;
            --control-bg: rgba(0, 0, 0, 0.7);
            --text-color: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .player-container {
            position: relative;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .player-container.portrait {
            max-width: 400px;
            margin: 0 auto;
        }
        
        #videoPlayer {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--control-bg);
            padding: 10px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }
        
        .player-container:hover .controls {
            transform: translateY(0);
        }
        
        .control-btn {
            background: transparent;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 16px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .progress-container {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            margin: 0 10px;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary-color);
            border-radius: 4px;
            width: 0%;
        }
        
        .volume-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .volume-slider {
            width: 80px;
        }
        
        select {
            background: var(--secondary-color);
            color: var(--text-color);
            border: none;
            padding: 5px;
            border-radius: 4px;
        }
        
        .playlist {
            background: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .playlist h2 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .playlist-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .playlist-item.active {
            background: rgba(52, 152, 219, 0.2);
            border-left: 3px solid var(--primary-color);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .error {
            color: #e74c3c;
            text-align: center;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                gap: 5px;
            }
            
            .progress-container {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>GhostPlayer</h1>
            <p>GitHub Releases 视频播放器</p>
        </header>
        
        <div class="player-container" id="playerContainer">
            <video id="videoPlayer" controls>
                您的浏览器不支持 HTML5 视频播放器。
            </video>
            <div class="controls">
                <button class="control-btn" id="playPauseBtn">播放</button>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <span id="timeDisplay">00:00 / 00:00</span>
                
                <div class="volume-container">
                    <button class="control-btn" id="muteBtn">音量</button>
                    <input type="range" min="0" max="1" step="0.1" value="1" class="volume-slider" id="volumeSlider">
                </div>
                
                <select id="speedSelect">
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1" selected>1x</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                    <option value="2">2x</option>
                </select>
                
                <select id="resolutionSelect">
                    <option value="auto">自动</option>
                    <option value="480">480p</option>
                    <option value="720">720p</option>
                    <option value="1080">1080p</option>
                </select>
                
                <button class="control-btn" id="downloadBtn">下载</button>
                <button class="control-btn" id="orientationBtn">横屏</button>
                <button class="control-btn" id="fullscreenBtn">全屏</button>
            </div>
        </div>
        
        <div class="playlist">
            <h2>播放列表</h2>
            <div id="playlistContent">
                <div class="loading">正在加载视频列表...</div>
            </div>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const videoPlayer = document.getElementById('videoPlayer');
        const playerContainer = document.getElementById('playerContainer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const timeDisplay = document.getElementById('timeDisplay');
        const muteBtn = document.getElementById('muteBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const speedSelect = document.getElementById('speedSelect');
        const resolutionSelect = document.getElementById('resolutionSelect');
        const downloadBtn = document.getElementById('downloadBtn');
        const orientationBtn = document.getElementById('orientationBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const playlistContent = document.getElementById('playlistContent');

        // 初始化变量
        let isPortrait = false;
        let currentVideoUrl = '';
        let videoFiles = [];

        // 从GitHub Releases获取视频列表
        async function fetchVideoList() {
            try {
                const response = await fetch('https://api.github.com/repos/Veltwilight/ghostplayer/releases');
                const releases = await response.json();
                
                if (!releases || releases.length === 0) {
                    playlistContent.innerHTML = '<div class="error">未找到任何发布版本</div>';
                    return;
                }
                
                // 从所有发布中提取媒体文件
                videoFiles = [];
                releases.forEach(release => {
                    if (release.assets && release.assets.length > 0) {
                        release.assets.forEach(asset => {
                            const fileName = asset.name.toLowerCase();
                            if (fileName.endsWith('.mp4') || fileName.endsWith('.webm') || 
                                fileName.endsWith('.ogg') || fileName.endsWith('.mov') ||
                                fileName.endsWith('.mp3') || fileName.endsWith('.wav') ||
                                fileName.endsWith('.aac') || fileName.endsWith('.flac')) {
                                videoFiles.push({
                                    name: asset.name,
                                    url: asset.browser_download_url,
                                    size: asset.size,
                                    release: release.name
                                });
                            }
                        });
                    }
                });
                
                if (videoFiles.length === 0) {
                    playlistContent.innerHTML = '<div class="error">未找到任何视频或音频文件</div>';
                    return;
                }
                
                // 渲染播放列表
                renderPlaylist();
                
                // 加载第一个视频
                if (videoFiles.length > 0) {
                    loadVideo(videoFiles[0].url, videoFiles[0].name);
                }
            } catch (error) {
                console.error('获取视频列表失败:', error);
                playlistContent.innerHTML = '<div class="error">获取视频列表失败，请检查网络连接</div>';
            }
        }

        // 渲染播放列表
        function renderPlaylist() {
            playlistContent.innerHTML = '';
            
            videoFiles.forEach((file, index) => {
                const playlistItem = document.createElement('div');
                playlistItem.className = 'playlist-item';
                if (index === 0) playlistItem.classList.add('active');
                
                playlistItem.innerHTML = `
                    <div><strong>${file.name}</strong></div>
                    <div>发布: ${file.release} | 大小: ${formatFileSize(file.size)}</div>
                `;
                
                playlistItem.addEventListener('click', () => {
                    // 移除所有active类
                    document.querySelectorAll('.playlist-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // 添加active类到当前项
                    playlistItem.classList.add('active');
                    
                    // 加载视频
                    loadVideo(file.url, file.name);
                });
                
                playlistContent.appendChild(playlistItem);
            });
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 加载视频
        function loadVideo(url, name) {
            currentVideoUrl = url;
            videoPlayer.src = url;
            videoPlayer.load();
            
            // 更新下载链接
            downloadBtn.onclick = () => {
                const a = document.createElement('a');
                a.href = url;
                a.download = name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };
            
            // 重置播放器状态
            playPauseBtn.textContent = '播放';
            progressBar.style.width = '0%';
            timeDisplay.textContent = '00:00 / 00:00';
        }

        // 播放/暂停控制
        playPauseBtn.addEventListener('click', () => {
            if (videoPlayer.paused || videoPlayer.ended) {
                videoPlayer.play();
                playPauseBtn.textContent = '暂停';
            } else {
                videoPlayer.pause();
                playPauseBtn.textContent = '播放';
            }
        });

        // 更新进度条
        videoPlayer.addEventListener('timeupdate', () => {
            const progress = (videoPlayer.currentTime / videoPlayer.duration) * 100;
            progressBar.style.width = `${progress}%`;
            
            const currentTime = formatTime(videoPlayer.currentTime);
            const duration = formatTime(videoPlayer.duration);
            timeDisplay.textContent = `${currentTime} / ${duration}`;
        });

        // 点击进度条跳转
        document.querySelector('.progress-container').addEventListener('click', (e) => {
            const progressContainer = e.currentTarget;
            const clickPosition = e.offsetX;
            const width = progressContainer.offsetWidth;
            const duration = videoPlayer.duration;
            
            videoPlayer.currentTime = (clickPosition / width) * duration;
        });

        // 音量控制
        volumeSlider.addEventListener('input', () => {
            videoPlayer.volume = volumeSlider.value;
            updateMuteButton();
        });

        // 静音控制
        muteBtn.addEventListener('click', () => {
            videoPlayer.muted = !videoPlayer.muted;
            updateMuteButton();
        });

        // 更新静音按钮状态
        function updateMuteButton() {
            if (videoPlayer.muted || videoPlayer.volume === 0) {
                muteBtn.textContent = '静音';
                volumeSlider.value = 0;
            } else {
                muteBtn.textContent = '音量';
                volumeSlider.value = videoPlayer.volume;
            }
        }

        // 播放速度控制
        speedSelect.addEventListener('change', () => {
            videoPlayer.playbackRate = parseFloat(speedSelect.value);
        });

        // 分辨率控制 (这里只是改变显示尺寸)
        resolutionSelect.addEventListener('change', () => {
            const resolution = resolutionSelect.value;
            
            if (resolution === 'auto') {
                videoPlayer.style.width = '100%';
                videoPlayer.style.height = 'auto';
            } else {
                const width = parseInt(resolution);
                const aspectRatio = videoPlayer.videoHeight / videoPlayer.videoWidth;
                const height = Math.round(width * aspectRatio);
                
                videoPlayer.style.width = `${width}px`;
                videoPlayer.style.height = `${height}px`;
            }
        });

        // 横竖屏切换
        orientationBtn.addEventListener('click', () => {
            isPortrait = !isPortrait;
            
            if (isPortrait) {
                playerContainer.classList.add('portrait');
                orientationBtn.textContent = '竖屏';
            } else {
                playerContainer.classList.remove('portrait');
                orientationBtn.textContent = '横屏';
            }
        });

        // 全屏控制
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                if (playerContainer.requestFullscreen) {
                    playerContainer.requestFullscreen();
                } else if (playerContainer.webkitRequestFullscreen) {
                    playerContainer.webkitRequestFullscreen();
                } else if (playerContainer.msRequestFullscreen) {
                    playerContainer.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        });

        // 格式化时间
        function formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // 初始化
        fetchVideoList();
    </script>
</body>
</html>